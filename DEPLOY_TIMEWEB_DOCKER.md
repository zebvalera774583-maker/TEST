# Полная инструкция: Деплой на Timeweb App Platform с Dockerfile

## ⚠️ Важно!

В Timeweb App Platform **нельзя изменить тип деплоя для уже существующего приложения**. 

Нужно создать **новое приложение** с типом "Dockerfile".

---

## Шаг 1: Подготовка (уже готово ✅)

Все файлы уже созданы и закоммичены в GitHub:
- ✅ `Dockerfile` - создан и настроен
- ✅ `next.config.ts` - включен `output: 'standalone'`
- ✅ `.dockerignore` - создан
- ✅ Репозиторий: `zebvalera774583-maker/TEST`
- ✅ Ветка: `main`
- ✅ Проект в папке: `test`

---

## Шаг 2: Создание нового приложения в Timeweb

1. **Войдите в панель Timeweb Cloud:**
   - Откройте [timeweb.cloud](https://timeweb.cloud)
   - Войдите в свой аккаунт

2. **Перейдите в App Platform:**
   - В левом меню найдите раздел **"App Platform"** или **"Приложения"**
   - Нажмите на него

3. **Создайте новое приложение:**
   - Нажмите кнопку **"Создать приложение"** или **"Новое приложение"** (обычно в правом верхнем углу)

---

## Шаг 3: Выбор типа деплоя

В форме создания приложения найдите раздел **"Тип"** или **"Тип деплоя"**:

1. Вы увидите несколько вкладок: "Next.js", "Node.js", "Dockerfile" и т.д.
2. **Выберите вкладку "Dockerfile"** (это важно!)
3. Если не видите вкладку "Dockerfile", ищите опцию "Docker" или "Custom Dockerfile"

---

## Шаг 4: Подключение репозитория

1. **Выберите источник:**
   - Выберите **GitHub** (или GitLab/Bitbucket, если используете)

2. **Авторизуйтесь в GitHub:**
   - Если нужно, авторизуйтесь в GitHub через Timeweb
   - Разрешите доступ к репозиториям

3. **Выберите репозиторий:**
   - Найдите и выберите: `zebvalera774583-maker/TEST`

4. **Выберите ветку:**
   - Ветка: `main`

5. **Укажите путь к Dockerfile:**
   - **Важно!** Укажите: `test/Dockerfile`
   - Или, если Timeweb позволяет указать рабочую директорию, укажите: `test` (и Dockerfile будет найден автоматически)

---

## Шаг 5: Настройка переменных окружения

В разделе **"Переменные окружения"** или **"Environment Variables"** добавьте:

```
NEXT_PUBLIC_SUPABASE_URL=ваш_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=ваш_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=ваш_service_role_key
ADMIN_PASSWORD=ваш_пароль_админа
NODE_ENV=production
```

**Где взять значения:**
- `NEXT_PUBLIC_SUPABASE_URL` и `NEXT_PUBLIC_SUPABASE_ANON_KEY` - из панели Supabase (Settings → API)
- `SUPABASE_SERVICE_ROLE_KEY` - из панели Supabase (Settings → API → service_role key)
- `ADMIN_PASSWORD` - ваш пароль для входа в админку (придумайте надежный)

**Важно:** Добавьте каждую переменную отдельно, нажимая "Добавить" после каждой.

---

## Шаг 6: Настройка ресурсов

Выберите тариф/конфигурацию:
- Минимальная конфигурация для Dockerfile обычно: **1 CPU, 1 ГБ RAM**
- Стоимость: **~800 ₽/мес** (как вы и говорили)

---

## Шаг 7: Настройка домена (после создания)

1. **После создания приложения** перейдите в его настройки
2. Найдите раздел **"Домены"** или **"Domains"**
3. Добавьте домены:
   - `ashot-zebelyan.ru`
   - `www.ashot-zebelyan.ru`
4. Timeweb покажет DNS записи, которые нужно добавить (обычно CNAME)

---

## Шаг 8: Настройка DNS в nic.ru

1. **Войдите в панель управления доменом в nic.ru**
2. **Перейдите в "Управление DNS-записями"** (или "DNS-master")
3. **Удалите старые записи** для Timeweb (если были)
4. **Добавьте новые DNS записи**, которые показал Timeweb:

   **Обычно это CNAME записи:**
   
   Для основного домена:
   - **Тип:** CNAME
   - **Имя:** `@` (или `ashot-zebelyan.ru`)
   - **Значение:** `ваш_домен.timeweb.cloud` (Timeweb покажет точное значение)
   - **TTL:** 3600
   
   Для www:
   - **Тип:** CNAME
   - **Имя:** `www`
   - **Значение:** `ваш_домен.timeweb.cloud` (или можно `ashot-zebelyan.ru`)
   - **TTL:** 3600

5. **Сохраните изменения**
6. **Подождите 10-30 минут** для распространения DNS

---

## Шаг 9: Запуск деплоя

1. В панели Timeweb нажмите **"Создать приложение"** или **"Развернуть"**
2. Дождитесь завершения сборки (обычно 5-10 минут для первого деплоя)
3. Следите за логами сборки в панели Timeweb

---

## Шаг 10: Проверка

После успешного деплоя:

1. **Подождите 10-30 минут** после настройки DNS
2. **Откройте сайт:** `https://ashot-zebelyan.ru`
3. **Проверьте админку:** `https://ashot-zebelyan.ru/admin`
4. **Проверьте загрузку фото** через админку

---

## Автоматические обновления

После настройки:
- Каждый раз, когда вы делаете `git push` в ветку `main`
- Timeweb автоматически:
  1. Получит изменения из GitHub
  2. Соберет Docker образ
  3. Запустит новую версию
  4. Сайт обновится автоматически!

---

## Если что-то не работает

1. **Проверьте логи** в панели Timeweb → ваше приложение → Логи
2. **Проверьте переменные окружения** - все ли правильно указаны
3. **Проверьте DNS** - правильно ли настроены записи
4. **Проверьте сборку** - нет ли ошибок при сборке Docker образа
5. **Проверьте путь к Dockerfile** - правильно ли указан `test/Dockerfile`

---

## Удаление старого приложения

После того как новое приложение с Dockerfile заработает:
- Старое приложение можно удалить (или оставить как резервную копию)
- Это сэкономит ресурсы

---

## Стоимость

- **Тариф с Dockerfile:** ~800 ₽/мес
- **Включает:** 1 CPU, 1 ГБ RAM, автодеплой, SSL сертификаты

---

**Готово! Если возникнут вопросы на каком-то шаге - пишите!**

