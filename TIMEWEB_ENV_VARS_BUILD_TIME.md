# Критическая проблема: переменные NEXT_PUBLIC_ не доступны при сборке

## Проблема:
Переменные окружения добавлены в Timeweb, но при сборке Next.js они не доступны.

## Почему это происходит:

### Важно для Next.js:
Переменные с префиксом `NEXT_PUBLIC_` должны быть доступны **во время сборки** (build time), а не только во время выполнения!

**Next.js встраивает эти переменные в JavaScript код на этапе сборки.**

Если переменные не доступны при сборке - они не будут встроены в код, и приложение не сможет их использовать.

---

## Возможные причины:

### 1. Переменные добавлены в неправильном месте

**Проблема:**
- Переменные могут быть добавлены в настройках "выполнения" (runtime), а не "сборки" (build)

**Решение:**
- Убедитесь, что переменные добавлены в разделе, который влияет на **сборку** приложения
- В Timeweb это должно быть в настройках приложения → "Переменные окружения"

### 2. Переменные добавлены после начала сборки

**Проблема:**
- Если переменные добавлены после того, как сборка уже началась, они не будут доступны

**Решение:**
- Добавьте переменные **ДО** начала сборки
- Или **пересоберите** приложение после добавления переменных

### 3. Переменные не сохранены

**Проблема:**
- Переменные добавлены, но не сохранены

**Решение:**
- Убедитесь, что нажали кнопку **"Сохранить"** или **"Применить"**
- Проверьте, что переменные остались в списке после сохранения

### 4. Проблема с форматом переменных в Timeweb

**Проблема:**
- Возможно, Timeweb требует особый формат для переменных сборки

**Решение:**
- Проверьте документацию Timeweb о переменных окружения для Dockerfile
- Возможно, нужно указать переменные в другом месте (например, в Dockerfile или в настройках сборки)

---

## Решение: Проверить настройки переменных в Timeweb

### Шаг 1: Открыть настройки приложения

1. В панели Timeweb Cloud
2. Перейдите в ваше приложение `ashot-zebelyan`
3. Перейдите в раздел **"Настройки"** или **"Settings"**
4. Найдите раздел **"Переменные окружения"** или **"Environment Variables"**

### Шаг 2: Проверить, где именно добавлены переменные

**Важно:** В Timeweb могут быть разные разделы для переменных:
- **Переменные сборки (Build variables)** - для этапа сборки
- **Переменные выполнения (Runtime variables)** - для этапа выполнения

**Нужны переменные сборки!**

### Шаг 3: Убедиться, что переменные в правильном разделе

Если есть разделение на "Build" и "Runtime":
- Переменные `NEXT_PUBLIC_*` должны быть в разделе **"Build"** или **"Build-time variables"**

### Шаг 4: Пересобрать приложение

После проверки/исправления:
1. Сохраните все изменения
2. Найдите кнопку **"Пересобрать"** или **"Rebuild"**
3. Нажмите её
4. Дождитесь новой сборки

---

## Альтернативное решение: Указать переменные в Dockerfile

Если Timeweb не передает переменные в процесс сборки, можно указать их в Dockerfile:

### Изменить Dockerfile:

```dockerfile
# В секции builder добавить ARG и ENV:
FROM base AS builder
WORKDIR /app
COPY --from=deps /app/node_modules ./node_modules
COPY . .

# Добавить ARG для переменных сборки
ARG NEXT_PUBLIC_SUPABASE_URL
ARG NEXT_PUBLIC_SUPABASE_ANON_KEY
ARG SUPABASE_SERVICE_ROLE_KEY
ARG ADMIN_PASSWORD
ARG NODE_ENV=production

# Преобразовать ARG в ENV для использования в сборке
ENV NEXT_PUBLIC_SUPABASE_URL=$NEXT_PUBLIC_SUPABASE_URL
ENV NEXT_PUBLIC_SUPABASE_ANON_KEY=$NEXT_PUBLIC_SUPABASE_ANON_KEY
ENV SUPABASE_SERVICE_ROLE_KEY=$SUPABASE_SERVICE_ROLE_KEY
ENV ADMIN_PASSWORD=$ADMIN_PASSWORD
ENV NODE_ENV=$NODE_ENV

# Переменные окружения для сборки
ENV NEXT_TELEMETRY_DISABLED 1
RUN npm run build
```

**Но это не рекомендуется** - лучше настроить переменные в Timeweb правильно.

---

## Проверка в Timeweb:

### Вопросы для проверки:

1. **Где именно вы добавили переменные?**
   - В настройках приложения?
   - В разделе "Переменные окружения"?
   - Есть ли разделение на "Build" и "Runtime"?

2. **Сохранены ли переменные?**
   - Остались ли они в списке после сохранения?

3. **Пересобрали ли вы приложение?**
   - После добавления переменных нужно пересобрать

---

## Рекомендация:

1. **Проверьте настройки переменных** в Timeweb
2. **Убедитесь, что они в разделе для сборки** (Build-time variables)
3. **Пересоберите приложение** после проверки
4. **Если не помогает** - обратитесь в поддержку Timeweb с вопросом: "Как правильно настроить переменные окружения NEXT_PUBLIC_* для сборки Next.js приложения в Dockerfile?"

---

**Главное:** Переменные `NEXT_PUBLIC_*` должны быть доступны **во время сборки**, а не только во время выполнения!

